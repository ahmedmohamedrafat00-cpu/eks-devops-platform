---
- name: Install base packages
  yum:
    name:
      - git
      - jq
      - unzip
      - curl
      - tar
      - bash-completion
      - python3
      - python3-pip
    state: present

- name: Install AWS CLI v2 if missing
  shell: |
    set -euo pipefail
    if command -v aws >/dev/null 2>&1; then
      exit 0
    fi
    cd /tmp
    curl -sSLo awscliv2.zip https://awscli.amazonaws.com/awscli-exe-linux-x86_64.zip
    unzip -q -o awscliv2.zip
    ./aws/install
  args:
    executable: /bin/bash
  changed_when: false

- name: Install kubectl if missing
  shell: |
    set -euo pipefail
    if command -v kubectl >/dev/null 2>&1; then
      exit 0
    fi
    KVER="$(curl -sSL https://dl.k8s.io/release/stable.txt)"
    curl -sSLo /usr/local/bin/kubectl "https://dl.k8s.io/release/${KVER}/bin/linux/amd64/kubectl"
    chmod +x /usr/local/bin/kubectl
  args:
    executable: /bin/bash
  changed_when: false

- name: Install Helm if missing
  shell: |
    set -euo pipefail
    if command -v helm >/dev/null 2>&1; then
      exit 0
    fi
    curl -sSL https://raw.githubusercontent.com/helm/helm/main/scripts/get-helm-3 | bash
  args:
    executable: /bin/bash
  changed_when: false

- name: Install Python AWS libraries
  pip:
    name:
      - boto3
      - botocore
    state: present
